"use strict";function check(e){id=e.id}var id,booksController=function(){function e(e){templates.get("books").then(function(t){var o=[];firebase.database().ref("books").on("value",function(a){var s=a.val();console.log(s),o.push(s),console.log(o),e.$element().html(t(o))})})}function t(e){templates.get("book-add").then(function(t){e.$element().html(t());var o=document.getElementById("title"),a=document.getElementById("author"),s=document.getElementById("desc");$("#btnAdd").on("click",function(){firebase.auth().onAuthStateChanged(function(t){if(t){var n=o.value,d=a.value,i=s.value,l=new Date;l=l.toLocaleDateString("bg-BG");var r;firebase.database().ref("users").child(t.uid).on("value",function(e){r=e.val(),console.log(r)});var c=firebase.database().ref(),u=c.push().key;c.child("users/"+t.uid).child("books/").push({id:u,title:n,author:d,description:i,postedBy:r.username,date:l});var f=firebase.database().ref(),h=f.push().key;f.child("books/"+h).push({id:h,title:n,author:d,description:i,postedBy:r.username,date:l}),toastr.success("Book added!"),e.redirect("#/books")}else e.redirect("#/login"),console.log("not logged in"),toastr.success("Please login")})})})}function o(e){console.log(id),templates.get("book").then(function(t){var o,a=[];firebase.database().ref("books").child(id).on("value",function(e){var t=e.exists();console.log(t),e.forEach(function(e){o=e.val(),console.log(o),a.push(o)})}),e.$element().html(t(a))})}function a(e){templates.get("post-add").then(function(t){e.$element().html(t());var o=document.getElementById("textComment");$("#addComment").on("click",function(){firebase.auth().onAuthStateChanged(function(t){var a,s=o.value;if(t){firebase.database().ref("books").child(id).on("value",function(e){var t=e.val();a=Object.keys(t)});var n=a.toString(),d=new Date;d=d.toLocaleDateString("bg-BG");var i;firebase.database().ref("users").child(t.uid).on("value",function(e){i=e.val()});firebase.database().ref("books").child(id).child(n).child("posts").push({message:s,postedBy:i.username,date:d,photoUrl:i.photoUrl});firebase.database().ref().child("users/"+t.uid).child("posts/").push({message:s,postedBy:i.username,date:d,photoUrl:i.photoUrl}),toastr.success("Comment added!"),e.redirect("#/books")}else e.redirect("#/login"),toastr.success("To Add Comment You Have To Logged in!")})})})}return{all:e,add:t,getById:o,addPost:a}}();